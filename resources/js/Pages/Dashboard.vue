<script setup>
import AppLayout from '@/Layouts/AppLayout.vue';
import Welcome from '@/Components/Welcome.vue';
</script>

<template>
    <AppLayout title="Dashboard">
        <template #header>
            <h2 class="font-semibold text-xl text-gray-800 leading-tight">
                Dashboard
            </h2>
        </template>
        <div class="template">
            <div class="center">
                <div class="template__row">
                    <div class="template__box">
                        <div class="template__box-block">
                            <svg height="72" id="svg1025" viewBox="0 0 19.05 19.050001" class="template__box__block-image" width="72" xmlns="http://www.w3.org/2000/svg" xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape" xmlns:sodipodi="http://sodipodi.sourceforge.net/DTD/sodipodi-0.dtd" xmlns:svg="http://www.w3.org/2000/svg"><defs id="defs1022"/><g id="layer1" style="opacity:1"><g id="g8351" style="stroke-width:0.349952" transform="matrix(2.8571247,0,0,2.8579415,-490.15954,-105.40537)"><path d="m 172.7962,38.651348 a 0.5183621,0.5183621 0 0 1 -0.51837,-0.518365 0.5183621,0.5183621 0 0 1 0.51836,-0.518367 0.5183621,0.5183621 0 0 1 0.51836,0.518359 0.5183621,0.5183621 0 0 1 -0.51835,0.518373 z" id="path17490-0" style="opacity:1;fill:#808080;fill-rule:evenodd;stroke:#808080;stroke-width:0.174976;stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:4;stroke-dasharray:none;paint-order:markers fill stroke;stop-color:#000000"/><path d="m 172.79619,42.814157 a 0.5183621,0.5183621 0 0 1 -0.51835,-0.518343 0.5183621,0.5183621 0 0 1 0.51834,-0.518387 0.5183621,0.5183621 0 0 1 0.51837,0.518372 0.5183621,0.5183621 0 0 1 -0.51836,0.518358 z" id="path17492-0" style="opacity:1;fill:#808080;fill-rule:evenodd;stroke:#808080;stroke-width:0.174976;stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:4;stroke-dasharray:none;paint-order:markers fill stroke;stop-color:#000000"/><path d="m 172.79615,40.732733 c -0.2862,0 -0.5183,-0.2321 -0.5183,-0.5184 0,-0.2862 0.2321,-0.5183 0.5183,-0.5183 0.2863,0 0.5184,0.2321 0.5184,0.5183 0,0.2863 -0.2321,0.5184 -0.5184,0.5184 z" id="path17494-3" style="opacity:1;fill:#808080;fill-rule:evenodd;stroke:#808080;stroke-width:0.174976;stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:4;stroke-dasharray:none;paint-order:markers fill stroke;stop-color:#000000"/><path d="m 176.98522,38.651348 a 0.5183621,0.5183621 0 0 1 -0.51837,-0.518365 0.5183621,0.5183621 0 0 1 0.51836,-0.518367 0.5183621,0.5183621 0 0 1 0.51836,0.518359 0.5183621,0.5183621 0 0 1 -0.51835,0.518373 z" id="path37298" style="opacity:1;fill:#808080;fill-rule:evenodd;stroke:#808080;stroke-width:0.174976;stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:4;stroke-dasharray:none;paint-order:markers fill stroke;stop-color:#000000"/><path d="m 176.98519,42.814157 a 0.5183621,0.5183621 0 0 1 -0.51835,-0.518343 0.5183621,0.5183621 0 0 1 0.51834,-0.518387 0.5183621,0.5183621 0 0 1 0.51837,0.518372 0.5183621,0.5183621 0 0 1 -0.51836,0.518358 z" id="path37300" style="opacity:1;fill:#808080;fill-rule:evenodd;stroke:#808080;stroke-width:0.174976;stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:4;stroke-dasharray:none;paint-order:markers fill stroke;stop-color:#000000"/><path d="m 176.98515,40.732732 c -0.2862,0 -0.5183,-0.2321 -0.5183,-0.5184 0,-0.2862 0.2321,-0.5183 0.5183,-0.5183 0.2863,0 0.5184,0.2321 0.5184,0.5183 0,0.2863 -0.2321,0.5184 -0.5184,0.5184 z" id="path37302" style="opacity:1;fill:#808080;fill-rule:evenodd;stroke:#808080;stroke-width:0.174976;stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:4;stroke-dasharray:none;paint-order:markers fill stroke;stop-color:#000000"/><path d="m 174.89071,38.651348 a 0.5183621,0.5183621 0 0 1 -0.51837,-0.518365 0.5183621,0.5183621 0 0 1 0.51836,-0.518367 0.5183621,0.5183621 0 0 1 0.51836,0.518359 0.5183621,0.5183621 0 0 1 -0.51835,0.518373 z" id="path37637" style="opacity:1;fill:#808080;fill-rule:evenodd;stroke:#808080;stroke-width:0.174976;stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:4;stroke-dasharray:none;paint-order:markers fill stroke;stop-color:#000000"/><path d="m 174.89071,40.732748 a 0.5183621,0.5183621 0 0 1 -0.51837,-0.518365 0.5183621,0.5183621 0 0 1 0.51836,-0.518367 0.5183621,0.5183621 0 0 1 0.51836,0.518359 0.5183621,0.5183621 0 0 1 -0.51835,0.518373 z" id="path37776" style="opacity:1;fill:#808080;fill-rule:evenodd;stroke:#808080;stroke-width:0.174976;stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:4;stroke-dasharray:none;paint-order:markers fill stroke;stop-color:#000000"/><path d="m 174.89071,42.814158 a 0.5183621,0.5183621 0 0 1 -0.51837,-0.518365 0.5183621,0.5183621 0 0 1 0.51836,-0.518367 0.5183621,0.5183621 0 0 1 0.51836,0.518359 0.5183621,0.5183621 0 0 1 -0.51835,0.518373 z" id="path37778" style="opacity:1;fill:#808080;fill-rule:evenodd;stroke:#808080;stroke-width:0.174976;stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:4;stroke-dasharray:none;paint-order:markers fill stroke;stop-color:#000000"/></g></g></svg>
                            <h1 class="template__box__block-title">
                                Название сервиза
                            </h1>
                        </div>
                        <div class="template__messages">
                            <div class="template__item">
                                <div>
                                    <h2 class="template__item-title">
                                        Сообщения
                                    </h2>

                                    <a v-for="message in $data.messages" href="#" class="template__item-box">
                                        <div class="template__item__box-block">
                                            <div v-if="message.status == 'unread'">
                                                <svg xmlns="http://www.w3.org/2000/svg" class="template__item__box__block-image" height="24" viewBox="0 -960 960 960" width="24"><path d="M160-160q-33 0-56.5-23.5T80-240v-480q0-33 23.5-56.5T160-800h640q33 0 56.5 23.5T880-720v480q0 33-23.5 56.5T800-160H160Zm320-280L160-640v400h640v-400L480-440Zm0-80 320-200H160l320 200ZM160-640v-80 480-400Z"/></svg>
                                            </div>
                                            <div v-else>
                                                <svg xmlns="http://www.w3.org/2000/svg" height="30" viewBox="0 -960 960 960" width="30"><path d="M638-80 468-250l56-56 114 114 226-226 56 56L638-80ZM480-520l320-200H160l320 200Zm0 80L160-640v400h206l80 80H160q-33 0-56.5-23.5T80-240v-480q0-33 23.5-56.5T160-800h640q33 0 56.5 23.5T880-720v174l-80 80v-174L480-440Zm0 0Zm0-80Zm0 80Z"/></svg>
                                            </div>
                                        </div>
                                        <div class="template__item__box-block" v-on:click="markAsRead(message.id,message.text, message.created_at, message.theme)">
                                            <h2 class="template__item__box__block-title">
                                                {{message.theme}}
                                            </h2>
                                            <p class="template__item__box__block-description">
                                                {{message.text}}
                                            </p>
                                        </div>
                                    </a>
                                </div>
                            </div>
                            <div class="template__button">
                                <a href="#" class="template__item__box-button">
                                    Новое сообщение
                                </a>
                            </div>
                        </div>

                        <div class="template__container">
                            <div class="template__container-date">
                                <p class="template__container__date-rate">
                                    {{$data.date}}
                                </p>
                            </div>
                            <form action="#">
                                <div class="form__item-block">
                                    <h2 class="form__item__block-title">
                                        {{$data.text?$data.theme: ""}}                                    </h2>
                                    <span class="form__item__block-description">
                                       {{$data.text?$data.text: ""}}
                                    </span>
                                </div>
                            </form>
                            <div class="form__item-block-box">
                                <label for="#" class="form__item__block__box-label">
                                    <input type="text" placeholder="Ответить" class="form__item__block__box-input">
                                </label>
                                <a href="#" class="form__item__block__box-image">
                                    <svg xmlns="http://www.w3.org/2000/svg" height="24" viewBox="0 -960 960 960" width="24" class="svg-icon">
                                        <path d="M120-160v-640l760 320-760 320Zm80-120 474-200-474-200v140l240 60-240 60v140Zm0 0v-400 400Z"/>
                                    </svg>
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </AppLayout>
</template>

<style>
 .template{
    width: 100%;
    height:auto;
    float: left;
 }
 .center{
     width: 90%;
     max-width: 1320px;
     height: auto;
     margin: 0 auto;
 }
 .template__row{
     width: 100%;
     height: auto;
     float: left;
     display: flex;
     flex-wrap: wrap;
     justify-content: space-between;
     align-items: center;
     margin-top: 50px;
     padding-top: 30px;
     background: rgb(239 239 239);
     border-radius: 15px;
     overflow: hidden;
     box-shadow: rgba(0, 0, 0, 1.2) 0px 10px 50px -20px,
                 rgba(0, 0, 0, 0.1) 0px 1px 5px,
                 rgba(0, 0, 0, 0.1) 0px 2px 5px -1px;
 }
 .template__box{
     width: 100%;
     height: auto;
     float: left;
     display: flex;
     flex-wrap: wrap;
     justify-content: flex-start;
 }
 .template__box-block{
     width: 100%;
     height: auto;
     float: left;
     display: flex;
     flex-wrap: wrap;
     align-items: center;
     margin-left: 20px;
     position: relative;
 }
 .template__box-block::after{
     content: '';
     width: 1320px;
     height: auto;
     position: relative;
     top: 0;
     right: 20px;
     border-bottom: 1px solid rgb(207 207 207 / 82%);
     margin-top: 20px;
 }
 .template__box__block-image{
     width: 30px;
     height: 30px;
     margin-right: 15px;
 }
 .template__box__block-title{
     width: fit-content;
     height: auto;
     float: left;
     font-size: 25px;
     font-weight: 400;
 }
 .template__messages {
     width: 24%;
     position: relative;
     padding-bottom: 30px;
 }
 .template__item {
     width: 100%;
     height: auto;
     float: left;
     margin-top: 15px;
     padding: 0 0 0 20px;
     position: relative;
     overflow-y: auto;
     overflow-x: hidden;
     max-height: 500px;
 }
 .template__container{
     width: 75%;
     height: auto;
     float: left;
     padding: 0 0 30px 30px;
     border-left: 1px solid rgb(207 207 207 / 82%);
 }
 .template__button{
     width: 84%;
     height: 70px;
     float: left;
     position: absolute;
     bottom: 30px;
     left: 20px;
     display: flex;
     height: auto;
 }
 .template__item-title{
     width: 100%;
     height: auto;
     float: left;
     font-size: 16px;
     font-weight: 500;
     color: rgb(100 96 96 / 82%);
     margin-bottom: 10px;
 }
 .template__item-box{
     width: 100%;
     height: auto;
     float: left;
     display: flex;
     flex-wrap: nowrap;
     align-items: center;
     padding: 15px 0 15px 10px;
     border-radius: 10px;
 }
 .template__item__box-block{
     width: fit-content;
     height: auto;
     float: left;
 }
 .template__item__box-block:nth-child(1){
     margin-right: 10px;
 }
 .template__item__box__block-image{
     width: 30px;
     height: 30px;
 }
 .template__item__box__block-title{
     width: fit-content;
     height: auto;
     float: left;
     font-size: 22px;
 }
 .template__item__box__block-description{
     width: fit-content;
     height: auto;
     float: left;
     font-size: 14px;
     font-weight: 500;
 }
 .template__item-block{
     width: 100%;
     height: auto;
     float: left;
     display: flex;
     flex-wrap: nowrap;
     align-items: center;
     padding: 15px 0 15px 10px;
     border-radius: 10px;
 }
 .template__item__block-block{
     width: fit-content;
     height: auto;
     float: left;
 }
 .template__item__block-block:nth-child(1){
     margin-right: 10px;
 }
 .template__item__block__block-image{
     width: 30px;
     height: 30px;
 }
 .template__item__block__block-title{
     width: fit-content;
     height: auto;
     float: left;
     font-size: 22px;
 }
 .template__item__block__block-description{
     width: fit-content;
     height: auto;
     float: left;
     font-size: 14px;
     font-weight: 500;
 }
 .template__item__box-button {
     padding: 8px 20px;
     border: navajowhite;
     color: #000;
     background-color: rgb(201 201 201 / 82%);
     border-radius: 20px;
     font-size: 20px;
     line-height: 130%;
     text-align: center;
     z-index: 999;
     width: 100%;
     display: inline-block;
 }
 .template__container-date{
     width: 100%;
     height: auto;
     float: right;
     display: flex;
     flex-wrap: nowrap;
     justify-content: flex-end;
     background-color: rgb(201 201 201 / 82%);
 }
 .template__container__date-rate{
     width: fit-content;
     height: auto;
     float: right;
     color: #fff;
     padding-right: 20px;
     font-size: 17px;
     font-weight: 400;
 }
 .template__box form{
     width: 100%;
     height: auto;
     float: left;
 }
 .form__item-block{
     width: 100%;
     height: auto;
     float: left;
     padding: 20px 0 0 30px;
 }
 .form__item__block-title{
     width: 100%;
     height: auto;
     float: left;
     font-size: 22px;
 }
 .form__item__block-description{
     width: 100%;
     height: auto;
     float: left;
     font-size: 16px;
     margin-top: 5px;
     color: rgb(151 151 151 / 82%);
 }
 .form__item-block-box{
     width: 100%;
     height: auto;
     float: left;
     display: flex;
     flex-wrap: wrap;
     align-items: center;
     margin-top: 340px;
 }
 .form__item__block__box-label{
     width: 80%;
     height: auto;
     float: left;
     margin-right: 10px;
 }
 .form__item__block__box-input{
     width: 100%;
     border: unset;
     border-radius: 10px;
     margin-bottom: 10px;
     padding-inline: 0;
     text-indent: 10px;
     font-size: 20px;
     padding-left: 10px;
 }
 .form__item__block__box-image{
     width: fit-content;
     height: auto;
     margin-bottom: 10px;
 }
 .svg-icon{
     fill: rgb(56 56 56 / 82%);
     width: 60px;
     height: 60px;
     float: left;
 }
 .template__item__box__block-description, .template__item__box__block-title {
     display: -webkit-box;
     -webkit-line-clamp: 1;
     -webkit-box-orient: vertical;
     overflow: hidden;
 }
 ::-webkit-scrollbar {
     width: 10px;
     height: 72px;
 }
 ::-webkit-scrollbar-thumb {
     background: rgb(201 201 201 / 82%);
     border-radius: 5px;
 }
 ::-webkit-scrollbar-track {
     background: transparent;
 }
 @media(max-width: 1170px) {
     .template__messages {
         width: 35%;
     }
     .template__container {
         width: 65%;
     }
 }

 @media(max-width: 768px) {
     .template__messages {
         width: 45%;
     }
     .template__container {
         width: 55%;
     }
 }
</style>

<script>
export default {
    data() {
        return {
            messages: [],
            text:"",
            date:"",
            theme:""
        };
    },
    props: {
        id: Number,
        messages: Array
    },

    created() {
        this.fetchLatestMessages();
        setInterval(this.fetchLatestMessages, 2000);

    },

    methods: {
        fetchLatestMessages() {
            axios.get('/api/user/messages/' + this.id)
                .then(response => {
                    this.messages = response.data;
                })
                .catch(error => {
                    console.error('Error fetching latest messages:', error);
                });
        },

        markAsRead(id,text,date,theme) {
            axios.get('/api/markAsRead/' + id)
                .catch(error => {
                    console.error('Error fetching latest messages:', error);
                });
            this.text = text
            this.date = date
            this.theme = theme
        }
    }
}

document.addEventListener("DOMContentLoaded", function() {
    // Получаем все элементы с классом template__item-box
    const templateItemBoxes = document.querySelectorAll(".template__item-box");

    // Перебираем все найденные элементы и добавляем обработчик события клика
    templateItemBoxes.forEach(function(itemBox) {
        itemBox.addEventListener("click", function(event) {
            // Отменяем стандартное действие ссылки
            event.preventDefault();

            // Получаем ближайший родительский элемент с классом template__item
            const templateItem = this.closest(".template__item");

            // Получаем контейнер, который нужно отобразить
            const templateContainer = templateItem.querySelector(".template__container");

            // Переключаем класс для отображения/скрытия контейнера
            templateContainer.classList.toggle("visible");
        });
    });
});

function getMessages() {

}
</script>
